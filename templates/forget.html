<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="static/css/login.css" rel="stylesheet" type="text/css">
    <title>forget?</title>
</head>

<body>
    <div class="center">
        <h1>Forget?</h1>
        <form method="post">
            <div class="txt_field" id="email">
                <input name="username" type="email" required>
                <span></span>
                <label>Email</label>
            </div>
            <div class="txt_field" id="OTP">
                <input name="OTP" type="text" required>
                <span></span>
                <label>OTP</label>
            </div>
            <div class="txt_field" id="newPassword">
                <input name="password" type="password" required>
                <span></span>
                <label>New Password</label>
            </div>
            <input type="submit" value="Next" id="input">
            <div class="signup_link">
                Not have an account? <a href="#">Signup</a>
            </div>
            <small class="warning">OTP is available on your email address</small>
        </form>
    </div>

    <script>
        var otp = document.getElementById('OTP')
        var email = document.getElementById('email')
        var newPassword = document.getElementById('newPassword')
        var warning = document.querySelector('.warning')
        const user = {
            email: document.querySelector('input[name="username"]').value,
        };

        warning.style.display = "none"
        newPassword.style.display = "none"
        otp.style.display = "none"
        const form_button = document.getElementById('input')

        function showOtp() {

            fetch('http://127.0.0.1:8000/users/verify', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(user)
            }).then(res => {
                if (res.status === 500) {
                    console.log("cannot send email")
                }
                else if (res.status === 422) {
                    console.log('invalid credential')
                }
                return res.json();
            }).then(data => {
                otpSent = true;
                sendBtn.innerText = "Sent";
                otpText.innerText = "Check your email for the OTP.";
                hideLoadingOverlay()
            }).catch(error => console.log(error))

            otp.style.display = "block"
            newPassword.style.display = "block"
            warning.style.display = "block"
            email.style.display = "none"
            form_button.innerText = "OK"

        }
        form_button.onclick = showOtp
    </script>
</body>

</html>